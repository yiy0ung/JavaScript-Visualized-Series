# ğŸš€âš™ï¸ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹œê°í™” : JavaScript ì—”ì§„

ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¢‹ì§€ë§Œ, ì‹¤ì œë¡œ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì´í•´í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ìˆë‚˜ìš”? ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°œë°œìë¼ê³  í•´ì„œ, ì»´íŒŒì¼ëŸ¬ë¥¼ ì§ì ‘ ë‹¤ë£° í•„ìš”ê°€ ì—†ì§€ë§Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì˜ ê¸°ë³¸ê³¼ ê°œë°œì ì¹œí™”ì ì¸ JS ì½”ë“œê°€ ì–´ë–»ê²Œ í•¸ë“¤ë§ ë˜ëŠ”ì§€ ì•„ëŠ” ê²ƒì€ ë¶„ëª…íˆ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.

> Note: ì´ ê¸€ì€ Node.jsì™€ í¬ë¡œë¯¸ì›€(Chromium)ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ë¸Œë¼ìš°ì €ê°€ ì‚¬ìš©í•˜ëŠ” V8 ì—”ì§„ì˜ ë‚´ìš©ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

---

HTML íŒŒì„œê°€ `src` ì†ì„±ê³¼ ê°™ì´ ìˆëŠ” `script`íƒœê·¸ë¥¼ ë§ë‹¥ëœ¨ë¦¬ë©´, ë„¤íŠ¸ì›Œí¬, ìºì‹œ, ë˜ëŠ” ì„¤ì¹˜ëœ ì„œë¹„ìŠ¤ ì›Œì»¤ ì¤‘ì—ì„œ `src`ê²½ë¡œì— ìˆëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ì´ë•Œ ìš”ì²­ëœ ìŠ¤í¬ë¦½íŠ¸ëŠ” Byte Steam Decoderê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” Byte Steamìœ¼ë¡œ ì‘ë‹µë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì´ì œ Byte Steam Decoderê°€ ë‹¤ìš´ë¡œë“œëœ steamì„ ë””ì½”ë”©í•©ë‹ˆë‹¤.

![first-js-engine](./gifs/jsEngine1.gif)

---

Byte Steam DecoderëŠ” ë””ì½”ë“œëœ byte steamìœ¼ë¡œ **í† í°**ì„ ë§Œë“­ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `0066` -> `f`, `0075` -> `u`, `006e` -> `n`, `0063` -> `c`, `0074` -> `t`, `0069` -> `i`, `006f` -> `o`, `006e` ->`n`ìœ¼ë¡œ ë””ì½”ë”©ë˜ê³  (ë‹¨ë½ì„ ë¶„ë³„í•˜ê¸°ìœ„í•´ ë’¤ì— ê³µë°±ì´ ì¶”ê°€ë˜ì–´ ìˆë‹¤) ì´ë ‡ê²Œ ìš°ë¦¬ê°€ ì‘ì„±í•œ `function`ì´ ë©ë‹ˆë‹¤. `function`ì€ JSì˜ ì˜ˆì•½ì–´ì´ë¯€ë¡œ í† í°ìœ¼ë¡œ ìƒì„±ë˜ê³  (gifì—” ì—†ëŠ”) pre-parserì™€ parserë¡œ ë³´ë‚´ì§‘ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ steamë„ ë§ˆì°¬ê°€ì§€ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

![second-js-engine](./gifs/jsEngine2.gif)

---

ì—”ì§„ì€ **pre-parser**ì™€ **parser**ë¼ëŠ” 2ê°œì˜ íŒŒì„œë¥¼ ì‚¬ìš©ëŠ” ë°, ì›¹ í˜ì´ì§€ì— ë¡œë”©ë˜ëŠ” ì‹œê°„ì„ ì¤„ì´ê¸° ìœ„í•´, ì—”ì§„ì€ ë¶ˆí•„ìš”í•œ ì½”ë“œëŠ” ì¦‰ì‹œ íŒŒì‹±í•˜ì§€ ì•Šìœ¼ë ¤ê³  í•©ë‹ˆë‹¤. **pre-parser**ëŠ” ë‚˜ì¤‘ì— ì‚¬ìš©í• ì§€ë„ ëª¨ë¥´ëŠ” ì½”ë“œë¥¼ ì²˜ë¦¬í•˜ê³  **parser**ëŠ” ì¦‰ì‹œ í•„ìš”í•œ ì½”ë“œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ë§Œì•½ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì˜€ì„ ë•Œë§Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤ë©´, ì´ í•¨ìˆ˜ëŠ” ì›¹í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ê¸° ìœ„í•´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¦‰ì‹œ ì»´íŒŒì¼í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤ë©´ í•´ë‹¹ ë¶€ë¶„ì˜ ì½”ë“œë¥¼ í•„ìš”ë¡œ í•˜ì—¬, **parser**ë¡œ ë³´ë‚´ì§€ê²Œ ë©ë‹ˆë‹¤.

íŒŒì„œ(parser)ëŠ” Byte Steam Decoderë¡œë¶€í„° ì˜¨ í† í°ì„ ê¸°ë°˜ ìœ¼ë¡œ ë…¸ë“œ(node)ë¥¼ ë§Œë“¤ê³ , ì´ ë…¸ë“œë¡œ Abstract Syntax Tree (ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬, AST)ë¥¼ ë§Œë“­ë‹ˆë‹¤. ğŸŒ³

![third-js-engine](./gifs/jsEngine3.gif)

---

ì´ì œ **ì¸í„°í”„ë¦¬í„°(interpreter ignition)ë¥¼** ì‚¬ìš©í•©ë‹ˆë‹¤. ì¸í„°í”„ë¦¬í„°ëŠ” ASTë¥¼ ì½ê³  ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ë°”ì´íŠ¸ ì½”ë“œ**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë°”ì´íŠ¸ ì½”ë“œê°€ ìƒì„±ë˜ë©´, ASTëŠ” ì‚­ì œë¨ê³¼ ë™ì‹œì— ë©”ëª¨ë¦¬ ê³µê°„ì—ì„œ ì§€ì›Œì§‘ë‹ˆë‹¤. ìš°ë¦° ì´ì œ **ë°”ì´íŠ¸ì½”ë“œ**ë¥¼ í†µí•´ ì—”ì§„ ì´ìš©í•œ ì‘ì—…ì„ í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤! ğŸ‰

![fourth-js-engine](./gifs/jsEngine4.gif)

---

ë°”ì´íŠ¸ì½”ë“œëŠ” ë¹ ë¥´ì§€ë§Œ, ë”ìš± ë¹ ë¥´ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë°”ì´íŠ¸ ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ `ì •ë³´`ê°€ ìƒì„±ë˜ëŠ”ë°, íŠ¹ì • í–‰ë™(event, function)ì´ ìì£¼ ë°œìƒí–ˆëŠ”ì§€, ì‚¬ìš©í–ˆì—ˆë˜ ë°ì´í„° íƒ€ì…ì¸ì§€ë¥¼ ê°ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë§ˆ ìš°ë¦¬ëŠ” ìˆ˜ì—†ì´ ë§ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆì„ ê²ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìƒì„±ëœ `ì •ë³´`ë¥¼ í†µí•´, ìš°ë¦¬ëŠ” ë”ìš± ë¹ ë¥´ê²Œ ì‹¤í–‰ ìœ„í•œ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ğŸƒğŸ½

Byte CodeëŠ”, ìƒì„±ëœ type feedbackê³¼ í•¨ê»˜ **ìµœì í™” ì»´íŒŒì¼ëŸ¬(optimizing compiler - TurboFan)ë¡œ** ë³´ë‚´ì§‘ë‹ˆë‹¤. ìµœì í™” ì»´íŒŒì¼ëŸ¬ëŠ” ì´ 2ê°€ì§€ë¥¼ ì´ìš©í•˜ì—¬, ë§¤ìš° ìµœì í™”ëœ ê¸°ê³„ì–´ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.ğŸš€

![fifth-js-engine](./gifs/jsEngine5.gif)

---

ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ì  íƒ€ì… ì–¸ì–´ì…ë‹ˆë‹¤. ë°ì´í„°ì˜ íƒ€ì… ê³„ì†í•´ì„œ ë°”ë€” ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë§Œì•½ ì–´ë–¤ ê°’ì´ ê°€ì§€ëŠ” ë°ì´í„° íƒ€ì…ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ë§¤ë²ˆ ê²€ì‚¬í•œë‹¤ë©´ êµ‰ì¥íˆ ëŠë¦´ ê²ƒì…ë‹ˆë‹¤.

ì½”ë“œë¥¼ í•´ì„(Interpret)í•˜ëŠ” ì‹œê°„ì„ ì¤„ì´ê¸° ìœ„í•´ì„œ, ìµœì í™”ëœ ê¸°ê³„ì–´(machine code)ì—ì„œëŠ” ë°”ì´íŠ¸ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ì—”ì§„ì´ ë³¸ ì  ìˆëŠ” ì¼€ì´ìŠ¤ë§Œ ì²˜ë¦¬í•˜ê³ , ë§Œì•½ ìš°ë¦¬ê°€ ë°˜ë³µí•´ì„œ ê°™ì€ íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” ì–´ë–¤ ì½”ë“œë¥¼ ì‚¬ìš©í•œë‹¤ë©´, ìµœì í™”ëœ ê¸°ê³„ì–´ì—ì„œëŠ” ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì´ì „ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜, JSëŠ” ë™ì ì¸ íƒ€ì…ì„ ê°€ì§€ê¸° ë•Œë¬¸ì—, ê°™ì€ ì½”ë“œë¼ í•˜ì—¬ë„ ê°‘ìê¸° ë‹¤ë¥¸ íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´, ê¸°ê³„ì–´ëŠ” ìµœì í™”ë˜ì§€ ì•Šê³ , ì—”ì§„ì€ ìƒì„±ëœ ë°”ì´íŠ¸ì½”ë“œë¥¼ ë‹¤ì‹œ í•´ì„(interpreting)í•˜ê²Œ ë©ë‹ˆë‹¤.

ì–´ë–¤ í•¨ìˆ˜ê°€ 100ë²ˆ í˜¸ì¶œë˜ì—ˆê³ , í•­ìƒ ê°™ì€ ê°’ì„ ë°˜í™˜í•œë‹¤ê³  ê°€ì •í•˜ì˜€ì„ ë•Œ, 101ì§¸ í˜¸ì¶œë˜ì—ˆì„ ë•Œë„ ê°™ì€ ê°’ì¼ ê²ƒì´ë¼ê³  ì˜ˆìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ì˜ â€œsumâ€í•¨ìˆ˜ë¥¼ ë³´ë©´, â€œsumâ€í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ í•­ìƒ ìˆ«ì ê°’ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

```javascript
function sum(a, b) {
  return a + b;
}

sum(1, 2);
```

ìˆ«ì `3`ì´ ë°˜í™˜ë©ë‹ˆë‹¤! ë‹¤ìŒì— í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ, 2ê°œì˜ ìˆ«ì ê°’ê³¼ í•¨ê»˜ í˜¸ì¶œí•  ê²ƒì´ë¼ê³  ì˜ˆìƒí•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

ë§Œì•½ ì´ ì˜ˆìƒì´ ë§ë‹¤ë©´, ë™ì  íƒìƒ‰(dynamic lookup)ì€ í•„ìš”í•˜ì§€ ì•Šì„ ê²ƒì´ê³  ìµœì í™”ëœ ê¸°ê³„ì–´ë¥¼ ì¬ì‚¬ìš©í•˜ë©´ ë  ê²ƒì…ë‹ˆë‹¤. í‹€ë ¸ë‹¤ë©´, ìµœì í™”ëœ ê¸°ê³„ì–´ ëŒ€ì‹  ì›ë˜ì˜ ë°”ì´íŠ¸ì½”ë“œë¡œ ë˜ëŒì•„ê°€ì•¼ í•©ë‹ˆë‹¤.

> ì—¬ê¸°ì„œ ë™ì  íƒìƒ‰(dynamic lookup)ì´ë€, ë°ì´í„°ì˜ ì €ì¥, ì‚­ì œê°€ ëŸ°íƒ€ì„ ìƒì—ì„œ ë™ì ìœ¼ë¡œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ê²½ìš°ì— ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ì ‘ê·¼ ë°©ì‹ì´ë‹¤. ë°ì´í„° í”„ë¡œí¼í‹°ì— ì ‘ê·¼í•  ë•Œ ë§ˆë‹¤, í•´ë‹¹ í”„ë¡œí¼í‹°ì˜ ë©”ëª¨ë¦¬ìƒì˜ ìœ„ì¹˜ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒì— í˜¸ì¶œí•  ë•Œ, ìˆ«ì ëŒ€ì‹  ë¬¸ìì—´ì„ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ì  íƒ€ì…ì„ ê°€ì§€ê¸° ë•Œë¬¸ì—, ì—ëŸ¬ë¥¼ ì¼ìœ¼í‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤!)

```javascript
function sum(a, b) {
  return a + b;
}

sum('1', 2);
```

ìˆ«ì 2ê°€ ê°•ì œë¡œ ë¬¸ìì—´ì´ ë˜ê³ , â€œ12â€ë¼ëŠ” ë¬¸ìì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì—”ì§„ì€ ë²ˆì—­(interpret)ëœ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„ìœ¼ë¡œ ëŒì•„ê°€ê³ , Type feedbackê°€ ìˆ˜ì •ë˜ë©°, ì´í›„ì— ìµœì í™” ì‘ì—…ì„ ê±°ì¹˜ê²Œ ë©ë‹ˆë‹¤.

---

ì „ì²´ì ì¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ë˜ì˜ ì‚¬ì§„ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.
![final-js-engine](./gifs/jsEngineTotal.gif)

#### ë§ˆì¹˜ë©°
ì´ ê¸€ì´ ë„ì›€ ë¬ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ë¬¼ë¡  ì—”ì§„ì˜ ëª¨ë“  ë¶€ë¶„ì„ ì´ ê¸€ì— ë‹´ì§„ ì•Šì•˜ì§€ë§Œ (JS heap, call stack, ë“±.) ì¶”í›„ ì‹œë¦¬ì¦ˆì—ì„œ ì´ì•¼ê¸°í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë‚´ë¶€ êµ¬ì¡°ì— ëŒ€í•´ ê´€ì‹¬ì´ ìƒê²¼ë‹¤ë©´, ì§ì ‘ ê²€ìƒ‰í•˜ì—¬ ì°¾ì•„ë³´ê¸°ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤. V8ì—”ì§„ì€ ì˜¤í”ˆì†ŒìŠ¤ ì´ê³  ë¬¸ì„œì—ì„œ ì–´ë–»ê²Œ ë‚´ë¶€ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ìì„¸íˆ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- [V8 Docs](https://v8.dev/)
- [V8 Github](https://github.com/v8/v8)
- [Chrome University 2018: Life Of A Script](https://www.youtube.com/watch?v=voDhHPNMEzg&t=729s%3Cbr%3E%0A)
- [V8 ì—”ì§„ ì»¨í¼ëŸ¬ìŠ¤ ì˜ìƒ](https://www.youtube.com/watch?time_continue=1513&v=p-iiEDtpy6I&feature=emb_title)
- [V8 Hidden Class - ë²ˆì—­ë³¸](https://engineering.linecorp.com/ko/blog/v8-hidden-class/)

> ë³¸ ì‹œë¦¬ì¦ˆì€ [DEV](https://dev.to/) ì— ì˜¬ë¼ì˜¨ [Lydia Hallie](https://github.com/lydiahallie)ì˜ **JavaScript Visualized ì‹œë¦¬ì¦ˆ**ë¥¼ ë²ˆì—­í•œ ê²ƒì…ë‹ˆë‹¤.
>
> - ë²ˆì—­ì— ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ [Pull Request](https://github.com/wlsdud2194/JavaScript-Visualized-Series/pulls)ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”.
> - origial author link : [Lydia Hallieì˜ dev.to](https://dev.to/lydiahallie)
